<title>View Data</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://angular-data-grid.github.io/dist/pagination.js"></script>
<script src="https://angular-data-grid.github.io/dist/JSONToCSVConvertor.js"></script>
<script src="https://angular-data-grid.github.io/dist/dataGrid.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

<div ng-app="view_data_table_app" ng-controller="view_data_table_controller" grid-actions="filtered_data"
     class="container-fluid view_data_table_container">
    <h2 class="heading_title">View Data</h2>
    <br>

    <script>
        // binding data recieved from sails controller to JS variable to pass it to angular
        var mbtb_data = <%- JSON.stringify(data) %>;
    </script>

    <form name="search_fields_form" ng-submit="submit_search_fields()" novalidate>

        <div class="row">
            <div class="col-md-4">
                <div class="form-group">
                    <label for="clinical_diagnosis">Clinical Diagnosis</label>
                    <select id="clinical_diagnosis" class="form-control"
                            ng-model="search_fields.clinical_diagnosis">
                        <option value="">All</option>
                        <option value="{{c_diagnosis_name}}" ng-repeat="c_diagnosis_name in clinical_diagnosis">
                            {{c_diagnosis_name}}
                        </option>
                    </select>
                </div>
            </div>

            <div class="col-md-4">
                <div class="form-group">
                    <label for="diafilter">Neuropathological Diagnosis</label>
                    <select id="diafilter" class="form-control"
                            ng-model="search_fields.neuropathology_diagnosis">
                        <option value="">All</option>
                        <option value="{{diagnosis_name}}" ng-repeat="diagnosis_name in neuropathology_diagnosis">
                            {{diagnosis_name}}
                        </option>
                    </select>
                </div>
            </div>

            <div class="col-md-4">
                <div class="form-group">
                    <label for="tissuefilter">Tissue Type</label>
                    <select id="tissuefilter" class="form-control"
                            ng-model="search_fields.tissue_type">
                        <option value="">All</option>
                        <option value="Brain">Brain</option>
                        <option value="Ocular">Ocular</option>
                        <option value="Eyes">Eyes</option>
                    </select>

                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-2">
                <div class="form-group">
                    <label for="selectSex">Sex</label>
                    <select id="selectSex"
                            class="form-control"
                            ng-model="search_fields.sex">
                        <option value="">Both</option>
                        <option value="Female">FEMALE</option>
                        <option value="Male">MALE</option>
                    </select>
                </div>
            </div>

            <div class="col-md-2">
                <label for="agemax">Age</label>
                <div class="row">
                    <div class="col-md-6">
                        <input id="age_min" type="number" min=0
                               class="form-control"
                               ng-model="search_fields.age_min"
                               placeholder="min">
                    </div>
                    <div class="col-md-6">
                        <input id="age_max" type="number" min=0
                               class="form-control"
                               ng-model="search_fields.age_max"
                               placeholder="max">
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <label for="PMImax">Postmortem Interval (hrs)</label>
                <div class="row">
                    <div class="col-md-6">
                        <input id="pmi_min" type="number" min=0
                               class="form-control"
                               ng-model="search_fields.pmi_min"
                               placeholder="min">
                    </div>
                    <div class="col-md-6">
                        <input id="pmi_max" type="number" min=0
                               class="form-control"
                               ng-model="search_fields.pmi_max"
                               placeholder="max">
                    </div>
                </div>
            </div>

            <div class="col-md-2">
                <label for="TiFmax">Time in Fix (days)</label>
                <div class="row">
                    <div class="col-md-6">
                        <input id="tif_min" type="number" min=0
                               class="form-control"
                               ng-model="search_fields.tif_min"
                               placeholder="min">
                    </div>
                    <div class="col-md-6">
                        <input id="tif_max" type="number" min=0
                               class="form-control"
                               ng-model="search_fields.tif_max"
                               placeholder="max">
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="form-group">
                    <label for="storage">Method of Preservation</label>
                    <select id="storage"
                            class="form-control"
                            ng-model="search_fields.preservation_method">
                        <option value="">All</option>
                        <option value="Formalin-Fixed">Formalin Fixed</option>
                        <option value="Fresh Frozen">Fresh Frozen</option>
                    </select>
                </div>
            </div>
        </div>

        <br>

        <div class="row button_holder">
            <button class="btn btn-primary export_button">Search</button>
        </div>

    </form>

    <div id="test" style="display: none">
        <div class="row container-fluid">
            <div grid-data id="test" grid-options="filtered_data" grid-actions="filtered_data">
                <div class="row-no-gutters">
                    <div class="col-sm-3">
                        <span class="items">{{filtered.length}} items  total</span>
                    </div>

                    <div class="row container-fluid">
                        <form class="form-inline pull-right margin-bottom-basic">
                            <div class="form-group">
                                <grid-pagination max-size="5" boundary-links="true" class="pagination-sm"
                                                 total-items="paginationOptions.totalItems" ng-model="paginationOptions.currentPage"
                                                 ng-change="reloadGrid()" items-per-page="paginationOptions.itemsPerPage">
                                </grid-pagination>
                            </div>
                            <div class="form-group items-per-page">
                                <label for="select_page">Item per page:</label>
                                <select id="select_page" class="form-control input-sm"
                                        ng-init="paginationOptions.itemsPerPage = '10'"
                                        ng-model="paginationOptions.itemsPerPage"
                                        ng-change="reloadGrid()">
                                    <option>10</option>
                                    <option>50</option>
                                    <option>100</option>
                                </select>
                            </div>
                        </form>
                    </div>

                    <table class="table table-bordered table-striped data_table">
                        <thead>
                        <tr>
                            <th data-field="num">No</th>
                            <th data-field="mbtb_code" sortable="mbtb_code" class="sortable">MBTB Code</th>
                            <th data-field="sex">Sex</th>
                            <th data-field="age">Age</th>
                            <th data-field="postmortem_interval">Postmortem Interval</th>
                            <th data-field="time_in_fix">Time in Fix (Days)</th>
                            <th data-field="preservation_method">Preservation Method</th>
                            <th data-field="clinical_diagnosis">Clinical Diagnosis</th>
                            <th data-field="neuropathology_diagnosis">Neuropathological Diagnosis</th>
                            <th data-field="tissue_type">Tissue Type</th>
                            <th data-field="storage_year">Storage Year</th>
                        </tr>
                        </thead>

                        <tbody>
                        <tr grid-item>
                            <td ng-init="elem_index = $index">{{elem_index+1}}</td>
                            <td>
                                <a ng-bind="item.mbtb_code" ng-href="/view_data/{{item.prime_details_id}}"></a>
                            </td>

                            <td ng-bind="item.sex"></td>
                            <td ng-bind="item.age"></td>
                            <td ng-bind="item.postmortem_interval"></td>
                            <td ng-bind="item.time_in_fix"></td>
                            <td ng_bind="item.preservation_method"></td>
                            <td ng_bind="item.clinical_diagnosis"></td>
                            <td ng-bind="item.neuro_diagnosis_id"></td>
                            <td ng_bind="item.tissue_type"></td>
                            <td ng_bind="item.storage_year"></td>
                        </tr>

                        </tbody>
                    </table>
                </div>

                <div class="row container-fluid">
                    <form class="form-inline pull-right margin-bottom-basic">
                        <div class="form-group pagination_container">
                            <grid-pagination max-size="5" boundary-links="true" class="pagination-sm"
                                             total-items="paginationOptions.totalItems" ng-model="paginationOptions.currentPage"
                                             ng-change="reloadGrid()" items-per-page="paginationOptions.itemsPerPage">
                            </grid-pagination>
                        </div>
                        <div class="form-group items-per-page">
                            <label for="select_page">Item per page:</label>
                            <select id="select_page" class="form-control input-sm"
                                    ng-init="paginationOptions.itemsPerPage = '10'"
                                    ng-model="paginationOptions.itemsPerPage"
                                    ng-change="reloadGrid()">
                                <option>10</option>
                                <option>50</option>
                                <option>100</option>
                            </select>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="row button_holder">
            <div class="col-md-12">
                <button class="btn btn-primary export_button" ng-click="exportToCsv(gridOptions.data)">Export data to CSV
                    <i class="fa fa-download"></i>
                </button>

                <button class="btn btn-primary export_button" ng-click="exportToCsv(filtered_data.data)">Export filtered data to CSV
                    <i class="fa fa-download"></i>
                </button>
            </div>
        </div>

    </div>

</div>
